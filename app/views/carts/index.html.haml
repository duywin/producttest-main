%html{ lang: "en" }
  %head
    %meta{ "http-equiv" => "Content-Type", content: "text/html; charset=UTF-8" }/
    %meta{ charset: "UTF-8" }/
    %meta{ name: "viewport", content: "width=device-width, initial-scale=1.0" }/
    %title Sale Management

  %body
    = hidden_field_tag 'api_cart_datatable', render_cart_datatable_carts_path
    = hidden_field_tag 'selected_week', params[:week] || '' # Hidden field for selected week
    = hidden_field_tag 'selected_day', params[:day] || ''   # Hidden field for selected day

    .jumbotron.text-center.app-color
      %h1 Sales Management

    %nav.navbar.navbar-expand-lg.navbar-light.app-color.topnav{ style: "margin-top: -10px" }
      .container-fluid
        %button.navbar-toggler{
          type: "button",
          "data-bs-toggle" => "collapse",
          "data-bs-target" => "#navbarNavDropdown",
          "aria-controls" => "navbarNavDropdown",
          "aria-expanded" => "false",
          "aria-label" => "Toggle navigation"
        }
          %span.navbar-toggler-icon
        #navbarNavDropdown.collapse.navbar-collapse
          %ul.navbar-nav.w-100.justify-content-around
            %li.nav-item.flex-fill
              %a.nav-link{ href: adminhomes_path } Home
            %li.nav-item.flex-fill
              %a.nav-link{ href: products_path } Product
            %li.nav-item.flex-fill
              %a.nav-link{ href: categories_path } Type
            %li.nav-item.flex-fill
              %a.nav-link{ href: accounts_path } Account
            %li.nav-item.active.flex-fill
              %a.nav-link{ href: carts_path } Sales

    .container-layout
      .week-navigation
        - @weeks.each do |week|
          = link_to week.strftime('%d %b %Y'),
            carts_path(week: week.strftime('%d %b %Y')),
            class: "week-selector #{params[:week] == week.strftime('%d %b %Y') ? 'active' : ''}",
            id: "week_selector_#{week.strftime('%d%b%Y')}",
            onclick: "$('#selected_week').val('#{week.strftime('%d %b %Y')}'); return true;" # Update hidden week field

      .main-content
        .weekday-header
          - %w(monday tuesday wednesday thursday friday saturday sunday).each do |day|
            = link_to day.capitalize,
              carts_path(week: params[:week], day: day, sort: params[:sort], direction: params[:direction]),
              class: "weekday #{params[:day] == day ? 'active' : ''} #{params[:week].present? ? '' : 'disabled'}",
              id: "day_selector_#{day}",
              data: { day: day },
              onclick: "$('#selected_day').val('#{day}'); return #{params[:week].present? ? 'true' : 'false'};" # Update hidden day field

        .table-responsive
          %table#carts-table.table.table-bordered.table-hover.shadow-sm
            %thead.table-light
              %tr
                %th Username
                %th Total
                %th Address
                %th Status
                %th Actions
            %tbody

    %footer.custom-footer.py-4.app-color
      %h1.text-center Admin Interface

    = javascript_include_tag 'views/cart/weekday_toggle'
    = javascript_include_tag 'views/cart/datatable_cart'
