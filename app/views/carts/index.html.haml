%html{:lang => "en"}
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %meta{:charset => "UTF-8"}/
    %meta{:content => "width=device-width, initial-scale=1.0", :name => "viewport"}/
    %title Sale Management
    :css
      .container-layout {
        display: flex;
        gap: 20px;
        padding: 20px;
      }
      .week-navigation {
        width: 200px;
        flex-shrink: 0;
      }
      .week-selector {
        display: block;
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        background: rgba(173, 216, 230, 0.7);
        border-radius: 6px;
        text-decoration: none;
        color: #333;
        transition: all 0.3s ease;
        border: 1px solid transparent;
      }
      .week-selector:hover {
        background: rgba(135, 206, 235, 0.9);
        transform: translateY(-1px);
      }
      .week-selector.active {
        background: #49c149;
        color: white;
        font-weight: 500;
        border: 1px solid #3da03d;
      }
      .main-content {
        flex: 1;
      }
      .weekday-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-bottom: 20px;
      }
      .weekday {
        display: block;
        padding: 12px 8px;
        background: rgba(173, 216, 230, 0.7);
        border-radius: 6px;
        text-decoration: none;
        color: #333;
        text-align: center;
        transition: all 0.3s ease;
        border: 1px solid transparent;
      }
      .weekday:hover {
        background: rgba(135, 206, 235, 0.9);
        transform: translateY(-1px);
      }
      .weekday.active {
        background: #49c149;
        color: white;
        font-weight: 500;
        border: 1px solid #3da03d;
      }
      @media (max-width: 768px) {
        .container-layout {
          flex-direction: column;
        }
        .week-navigation {
          width: 100%;
        }
        .weekday-header {
          grid-template-columns: repeat(4, 1fr);
          gap: 8px;
        }
        .weekday {
          margin-bottom: 8px;
        }
      }
      .weekday.disabled {
        pointer-events: none;
        background: rgba(220, 220, 220, 0.7);
        color: #999;
        cursor: not-allowed;
      }
      @media (max-width: 576px) {
            .weekday-header {
              grid-template-columns: repeat(2, 1fr);
            }
      }

  %body
    .jumbotron.text-center.app-color
      %h1 Sales management
    %nav.navbar.navbar-expand-lg.navbar-light.app-color.topnav{:style => "margin-top: -10px"}
      .container-fluid
        %button.navbar-toggler{"aria-controls" => "navbarNavDropdown", "aria-expanded" => "false", "aria-label" => "Toggle navigation", "data-bs-target" => "#navbarNavDropdown", "data-bs-toggle" => "collapse", :type => "button"}
          %span.navbar-toggler-icon
        #navbarNavDropdown.collapse.navbar-collapse
          %ul.navbar-nav.w-100.justify-content-around
            %li.nav-item.flex-fill
              %a.nav-link{:href => adminhomes_path} Home
            %li.nav-item.flex-fill
              %a.nav-link{:href => products_path} Product
            %li.nav-item.flex-fill
              %a.nav-link{:href => categories_path} Type
            %li.nav-item.flex-fill
              %a.nav-link{:href => accounts_path} Account
            %li.nav-item.active.flex-fill
              %a.nav-link{:href => carts_path} Sales
    .container-layout
      .week-navigation
        - @weeks.each do |week|
          = link_to week.strftime('%d %b %Y'),
            carts_path(week: week.strftime('%d %b %Y')),
            class: "week-selector #{params[:week] == week.strftime('%d %b %Y') ? 'active' : ''}"
      .main-content
        .weekday-header
          - %w(monday tuesday wednesday thursday friday saturday sunday).each do |day|
            = link_to day.capitalize,
              carts_path(week: params[:week], day: day, sort: params[:sort], direction: params[:direction]),
              class: "weekday #{params[:day] == day ? 'active' : ''} #{params[:week].present? ? '' : 'disabled'}",
              onclick: "return #{params[:week].present? ? 'true' : 'false'};"

        .table-responsive
          %table.table.table-bordered.table-hover.shadow-sm
            %thead.table-light
              %tr
                %th
                  = link_to carts_path(params.permit(:week, :day).merge(sort: 'account_id', direction: params[:sort] == 'account_id' && params[:direction] == 'asc' ? 'desc' : 'asc')) do
                    Username
                    = params[:sort] == 'account_id' ? (params[:direction] == 'asc' ? '↑' : '↓') : '↕'
                %th
                  = link_to carts_path(params.permit(:week, :day).merge(sort: 'total_price', direction: params[:sort] == 'total_price' && params[:direction] == 'asc' ? 'desc' : 'asc')) do
                    Total
                    = params[:sort] == 'total_price' ? (params[:direction] == 'asc' ? '↑' : '↓') : '↕'
                %th
                  = link_to carts_path(params.permit(:week, :day).merge(sort: 'address', direction: params[:sort] == 'address' && params[:direction] == 'asc' ? 'desc' : 'asc')) do
                    Address
                    = params[:sort] == 'address' ? (params[:direction] == 'asc' ? '↑' : '↓') : '↕'
                %th
                  = link_to carts_path(params.permit(:week, :day).merge(sort: 'status', direction: params[:sort] == 'status' && params[:direction] == 'asc' ? 'desc' : 'asc')) do
                    Status
                    = params[:sort] == 'status' ? (params[:direction] == 'asc' ? '↑' : '↓') : '↕'
                %th Actions
            %tbody
              - @carts.each do |cart|
                %tr
                  %td= cart.account&.username || 'N/A'
                  %td= number_to_currency(cart.total_price)
                  %td= cart.address.presence || 'N/A'
                  %td= cart.status.presence || 'N/A'
                  %td
                    .d-flex.gap-2.justify-content-center
                      = button_to cart_path(cart.id),
                        method: :get,
                        class: 'btn btn-outline-primary btn-sm',
                        title: 'View Details' do
                        %span 👁
                      = button_to edit_cart_path(cart),
                        method: :get,
                        class: 'btn btn-primary btn-sm',
                        title: 'Edit cart' do
                        %span ✎
    %footer.custom-footer.py-4.app-color
      %h1.text-center Admin Interface

:coffeescript
  document.addEventListener 'DOMContentLoaded', ->

  weekSelectors = document.querySelectorAll('.week-selector')
  weekdayLinks = document.querySelectorAll('.weekday')

  # Function to toggle weekday link activation
  toggleWeekdayLinks = (enable) ->
    weekdayLinks.forEach (link) ->
      if enable
        link.classList.remove('disabled')
      else
        link.classList.add('disabled')

  # Add event listeners to week selectors
  weekSelectors.forEach (weekSelector) ->
    weekSelector.addEventListener 'click', ->
      isActive = @classList.contains('active')
      toggleWeekdayLinks(isActive)

  # Disable weekdays initially if no week is selected
  activeWeek = document.querySelector('.week-selector.active')
  toggleWeekdayLinks(!!activeWeek)

